<VirtualHost *:443>
    ServerName apate-backend.com

    SSLProxyEngine On
    SSLEngine on
    # Uncomment the following line if you have a chain certificate
    # SSLCertificateChainFile /etc/httpd/ssl/ssl_certificate_chain.crt

    ProxyPass /apate/ http://localhost:8000/
    ProxyPassReverse /apate/ http://localhost:8000/

    ProxyPass /nordic-solar/ http://localhost:3000/
    ProxyPassReverse /nordic-solar/ http://localhost:3000/

    ProxyPass /uniswap/ http://localhost:3001/
    ProxyPassReverse /uniswap/ http://localhost:3001/

<Location "/uswgql/">
    # Разрешение CORS для OPTIONS-запросов
    <If "%{REQUEST_METHOD} == 'OPTIONS'">
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Header always set Access-Control-Allow-Headers "*"
        Header always set Access-Control-Max-Age "1728000"
        Header always set Content-Type "text/plain; charset=utf-8"
        Header always set Content-Length "0"
        SetHandler "none"
        Require all granted
    </If>

    # Разрешение CORS для POST-запросов
    <If "%{REQUEST_METHOD} == 'POST'">
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Header always set Access-Control-Allow-Headers "*"
        Header always set Access-Control-Expose-Headers "*"
    </If>

    # Разрешение CORS для GET-запросов
    <If "%{REQUEST_METHOD} == 'GET'">
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Header always set Access-Control-Allow-Headers "*"
        Header always set Access-Control-Expose-Headers "*"
    </If>

    # Настройки прокси

    # Установка дополнительных заголовков для прокси
    RequestHeader set X-Forwarded-For "62.212.64.20"
    RequestHeader set Origin "https://app.uniswap.org"
    RequestHeader set Referer "https://app.uniswap.org"
    Header unset Access-Control-Allow-Origin

    ProxyPass https://interface.gateway.uniswap.org/
    ProxyPassReverse https://interface.gateway.uniswap.org/

</Location>

    <Location "/infura/">
    # Разрешение CORS для OPTIONS-запросов
    <If "%{REQUEST_METHOD} == 'OPTIONS'">
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Header always set Access-Control-Allow-Headers "*"
        Header always set Access-Control-Max-Age "1728000"
        Header always set Content-Type "text/plain; charset=utf-8"
        Header always set Content-Length "0"
        SetHandler "none"
        Require all granted
    </If>

    # Разрешение CORS для POST-запросов
    <If "%{REQUEST_METHOD} == 'POST'">
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Header always set Access-Control-Allow-Headers "*"
        Header always set Access-Control-Expose-Headers "*"
    </If>

    # Разрешение CORS для GET-запросов
    <If "%{REQUEST_METHOD} == 'GET'">
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Header always set Access-Control-Allow-Headers "*"
        Header always set Access-Control-Expose-Headers "*"
    </If>

    # Прокси-настройки
    ProxyPass https://mainnet.infura.io/
    ProxyPassReverse https://mainnet.infura.io/

    # Установка заголовков для прокси
    RequestHeader set X-Forwarded-For "62.212.64.20"
    RequestHeader set Origin "https://app.uniswap.org"
    RequestHeader set Referer "https://app.uniswap.org"

    # Удаление заголовков
    Header unset Access-Control-Allow-Origin
    </Location>
    SSLCertificateFile /etc/letsencrypt/live/apate-backend.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/apate-backend.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf


</VirtualHost>



